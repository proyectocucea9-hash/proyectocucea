<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}Transparencia Presupuestaria{% endblock %} | CUCEA</title>

    <!-- Bootstrap 5 - Para Modal y Carrusel de Cards -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fuente Montserrat - Tipografía moderna y corporativa -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- FontAwesome - Iconos para Footer (Facebook, WhatsApp) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Estilos propios -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {# ==========================================================================
       NAVBAR SUPERIOR - Fija (sticky), altura constante, sin shrink al scroll
       ========================================================================== #}
    <header class="navbar navbar--sticky" id="main-navbar">
        <div class="navbar__container">
            <!-- Logo a la izquierda -->
            <a href="{{ url_for('index') }}" class="navbar__brand">
                <span class="navbar__logo">CUCEA</span>
                <span class="navbar__subtitle">Transparencia</span>
            </a>

            <nav class="navbar__menu">
                <a href="{{ url_for('index') }}" class="navbar__link">Inicio</a>
                <a href="{{ url_for('presupuestos_lista') }}" class="navbar__link">Presupuesto</a>
                {% if current_user.is_authenticated and current_user.es_administrador %}
                    <a href="{{ url_for('presupuesto_nuevo') }}" class="navbar__link navbar__link--admin">Agregar</a>
                    {% if current_user.es_super_administrador %}
                    <a href="{{ url_for('admin_usuarios') }}" class="navbar__link">Gestionar Usuarios</a>
                    {% endif %}
                    <span class="navbar__user">{{ current_user.nombre }}</span>
                    <a href="{{ url_for('auth_logout') }}" class="navbar__link navbar__link--logout">Cerrar sesión</a>
                {% else %}
                    <a href="{{ url_for('auth_login') }}" class="navbar__link navbar__link--cta">Iniciar Sesión</a>
                {% endif %}
            </nav>

            <!-- Total de Gastos: suma real de cantidad_gasto (BD), formato profesional y badge a la derecha -->
            <div class="navbar__total-invertido">
                <i class="fas fa-coins" aria-hidden="true"></i>
                <span>Total de Gastos:</span>
                <span class="badge bg-success">${{ "{:,.2f}".format(total_invertido) }}</span>
            </div>

            <button class="navbar__toggle" id="navbar-toggle" aria-label="Abrir menú">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    {# ==========================================================================
       FOOTER - Franja 4: Datos de contacto + iconos Facebook y WhatsApp
       ========================================================================== #}
    <footer class="footer">
        <div class="footer__content">
            <div class="footer__section">
                <h4 class="footer__title">Centro Universitario de Ciencias Económico Administrativas</h4>
                <p class="footer__text">Plataforma de Transparencia Informática</p>
            </div>
            <div class="footer__section">
                <h4 class="footer__title">Contacto</h4>
                <p class="footer__text"><i class="fas fa-envelope"></i> transparencia@cucea.udg.mx</p>
                <p class="footer__text"><i class="fas fa-phone"></i> (33) 3770-3300</p>
                <p class="footer__text"><i class="fas fa-map-marker-alt"></i> Periférico Norte 799, Zapopan, Jalisco</p>
            </div>
            <div class="footer__section footer__social">
                <h4 class="footer__title">Síguenos</h4>
                <a href="https://www.facebook.com/CUCEA.UDG" target="_blank" rel="noopener" class="footer__icon" aria-label="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://wa.me/523337703300" target="_blank" rel="noopener" class="footer__icon" aria-label="WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>
        <div class="footer__bottom">
            <p>&copy; {{ current_year }} CUCEA - Universidad de Guadalajara. Todos los derechos reservados.</p>
        </div>
    </footer>

    {# ==========================================================================
       CHATBOT ROBOTSITO - Entrada espectacular: robot 2D + globo cómic → remolino → botón con pulso
       ========================================================================== #}
    <div id="chatbot-widget" class="chatbot-widget" aria-label="Asistente de presupuestos">
        <!-- Fase 1: Robot 2D (droid+HERBIE) + globo de pensamiento tipo cómic -->
        <div id="chatbot-welcome" class="chatbot-welcome">
            <div class="chatbot-welcome__wrap">
                <div id="chatbot-bubble" class="chatbot-welcome__bubble comic-bubble">
                    <p class="chatbot-welcome__text">
                        <span class="chatbot-welcome__text-inner">¡Hola! Soy tu asistente de presupuestos. ¡Vamos a cuidar esos pesos!</span>
                    </p>
                </div>
                <div id="chatbot-robot-big" class="chatbot-robot-big" aria-hidden="true">
                    <svg class="chatbot-robot-svg" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <!-- Antena -->
                        <line x1="60" y1="12" x2="60" y2="28" stroke="var(--color-udg-gold)" stroke-width="3" stroke-linecap="round"/>
                        <circle cx="60" cy="10" r="6" fill="var(--color-udg-gold)"/>
                        <!-- Cabeza tipo domo (droid/HERBIE) -->
                        <circle cx="60" cy="48" r="40" fill="var(--color-chatbot-bubble)" stroke="var(--color-udg-gold)" stroke-width="2"/>
                        <circle cx="60" cy="48" r="36" fill="#3a6ea5"/>
                        <!-- Ojos -->
                        <ellipse cx="44" cy="45" rx="10" ry="12" fill="#1a365d"/>
                        <ellipse cx="76" cy="45" rx="10" ry="12" fill="#1a365d"/>
                        <circle cx="46" cy="44" r="3" fill="#fff"/>
                        <circle cx="78" cy="44" r="3" fill="#fff"/>
                        <!-- Sonrisa -->
                        <path d="M 40 62 Q 60 74 80 62" stroke="#1a365d" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                        <!-- Cuerpo -->
                        <rect x="28" y="88" width="64" height="44" rx="10" fill="var(--color-chatbot-bg)" stroke="var(--color-udg-gold)" stroke-width="2"/>
                        <rect x="32" y="92" width="56" height="36" rx="6" fill="#2c5282"/>
                        <!-- Panel frontal -->
                        <rect x="48" y="98" width="24" height="20" rx="2" fill="var(--color-udg-gold)" opacity="0.9"/>
                    </svg>
                </div>
            </div>
        </div>
        <!-- Fase 2: Botón circular con cara del robot (después del remolino) + efecto pulso -->
        <button type="button" id="chatbot-toggle" class="chatbot-toggle" aria-label="Abrir chat" title="Abrir chat">
            <svg class="chatbot-toggle-face" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <circle cx="60" cy="48" r="36" fill="rgba(255,255,255,0.25)"/>
                <ellipse cx="44" cy="45" rx="8" ry="10" fill="#fff"/>
                <ellipse cx="76" cy="45" rx="8" ry="10" fill="#fff"/>
                <circle cx="46" cy="44" r="2" fill="#1a365d"/>
                <circle cx="78" cy="44" r="2" fill="#1a365d"/>
                <path d="M 42 60 Q 60 70 78 60" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/>
            </svg>
        </button>
        <!-- Ventana de chat -->
        <div id="chatbot-panel" class="chatbot-panel">
            <div class="chatbot-panel__header">
                <span class="chatbot-panel__title"><i class="fas fa-robot"></i> Asistente CUCEA</span>
                <button type="button" id="chatbot-close" class="chatbot-panel__close" aria-label="Cerrar chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-panel__messages" id="chatbot-messages">
                <div class="chatbot-msg chatbot-msg--bot">
                    <span class="chatbot-msg__bubble">Escribe tu pregunta o elige un tema frecuente abajo.</span>
                </div>
            </div>
            <div class="chatbot-panel__faq">
                <p class="chatbot-panel__faq-title">Preguntas frecuentes</p>
                <button type="button" class="chatbot-faq-btn" data-faq="presupuesto">¿Cómo subir un presupuesto?</button>
                <button type="button" class="chatbot-faq-btn" data-faq="superadmin">¿Quién es el Super Admin?</button>
                <button type="button" class="chatbot-faq-btn" data-faq="sede">¿Cómo filtrar por sede?</button>
            </div>
            <div class="chatbot-panel__input">
                <input type="text" id="chatbot-input" class="chatbot-input" placeholder="Escribe tu pregunta..." autocomplete="off">
                <button type="button" id="chatbot-send" class="chatbot-send" aria-label="Enviar">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS - Requerido para Modal y Carrusel -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
