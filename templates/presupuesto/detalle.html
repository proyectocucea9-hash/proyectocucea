{# ==========================================================================
   PÁGINA DE DETALLE DE PRESUPUESTO - /presupuesto/<id>
   Muestra la información completa del proyecto.
   Si ADMIN: botones Editar y Eliminar visibles.
   ========================================================================== #}

{% extends "base/layout.html" %}
{% block title %}{{ presupuesto.concepto }}{% endblock %}

{% block content %}
<div class="detalle-page">
    <article class="detalle-card card">
        {# Imagen del proyecto #}
        <div class="detalle-card__image">
            {% if presupuesto.imagen_url %}
            <img src="{{ presupuesto.imagen_url if presupuesto.imagen_url.startswith('http') else url_for('static', filename=presupuesto.imagen_url) }}" alt="{{ presupuesto.concepto }}">
            {% else %}
            <div class="detalle-card__placeholder">
                <i class="fas fa-image"></i>
                <span>Sin imagen</span>
            </div>
            {% endif %}
        </div>

        <div class="detalle-card__body">
            <p class="detalle-card__date">{{ presupuesto.fecha.strftime('%d/%m/%Y') }}</p>
            <h1 class="detalle-card__title">{{ presupuesto.concepto }}</h1>
            <span class="detalle-card__badge">{{ presupuesto.categoria }}</span>
            <p class="detalle-card__monto">${{ "{:,.2f}".format(presupuesto.monto) }}</p>
            {% if presupuesto.descripcion %}
            <div class="detalle-card__descripcion">
                {{ presupuesto.descripcion }}
            </div>
            {% endif %}

            {# Solo administradores ven acciones #}
            {% if current_user.is_authenticated and current_user.es_administrador %}
            <div class="detalle-card__actions">
                <a href="{{ url_for('presupuesto_editar', id=presupuesto.id) }}" class="btn btn--secondary">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <form action="{{ url_for('presupuesto_eliminar', id=presupuesto.id) }}" method="POST" class="form-inline" onsubmit="return confirm('¿Eliminar este proyecto?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn--danger">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
    </article>

    <a href="{{ url_for('presupuestos_lista') }}" class="btn btn--secondary">← Volver al listado</a>
</div>
{% endblock %}
